name: Test Matrix Status

on:
  workflow_run:
    workflows: ["CI Pipeline"]
    types:
      - completed
  workflow_dispatch:

jobs:
  test-summary:
    name: Test Summary Report
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' || github.event_name == 'workflow_dispatch' }}
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        
      - name: Generate Test Summary
        run: |
          echo "# 📊 Test Suite Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## Test Types Coverage" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Test Type | Status | Description |" >> $GITHUB_STEP_SUMMARY
          echo "|-----------|--------|-------------|" >> $GITHUB_STEP_SUMMARY
          echo "| **Unit Tests** | ✅ Enabled | Core business logic validation |" >> $GITHUB_STEP_SUMMARY
          echo "| **Feature Tests** | ✅ Enabled | API endpoints and workflows |" >> $GITHUB_STEP_SUMMARY
          echo "| **Integration Tests** | ✅ Enabled | External service interactions |" >> $GITHUB_STEP_SUMMARY
          echo "| **Behat Tests** | ✅ Enabled | BDD acceptance scenarios |" >> $GITHUB_STEP_SUMMARY
          echo "| **Security Tests** | ✅ Enabled | Authentication and authorization |" >> $GITHUB_STEP_SUMMARY
          echo "| **Performance Tests** | ✅ Enabled | Load and stress testing |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## Behat Test Features" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Feature | Scenarios | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|---------|-----------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| Account Management | 3 | ✅ Active |" >> $GITHUB_STEP_SUMMARY
          echo "| Basket Management | 1 (+3 WIP) | ⚠️ Partial |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## Configuration" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Queue Driver**: `sync` (for predictable test execution)" >> $GITHUB_STEP_SUMMARY
          echo "- **Non-interactive**: Enabled (no prompts in CI)" >> $GITHUB_STEP_SUMMARY
          echo "- **Exit Codes**: Proper (0=success, 1=failure)" >> $GITHUB_STEP_SUMMARY
          echo "- **Test Artifacts**: JUnit XML reports uploaded" >> $GITHUB_STEP_SUMMARY
          
      - name: Check Test Scripts
        run: |
          echo "## Available Test Commands" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "```bash" >> $GITHUB_STEP_SUMMARY
          echo "# Run all Behat tests (CI mode)" >> $GITHUB_STEP_SUMMARY
          echo "./bin/behat-ci" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "# Run specific feature" >> $GITHUB_STEP_SUMMARY
          echo "vendor/bin/behat --no-interaction features/account_management.feature" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "# Run with specific profile" >> $GITHUB_STEP_SUMMARY
          echo "vendor/bin/behat --profile=ci" >> $GITHUB_STEP_SUMMARY
          echo "```" >> $GITHUB_STEP_SUMMARY